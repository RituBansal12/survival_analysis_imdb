# survival_analysis_imdb
Use IMDb dataset to implement survival analysis algorithms

## Data
Location: https://datasets.imdbws.com/

### IMDb datasets used
Each dataset is contained in a gzipped, tab-separated-values (TSV) formatted file in the UTF-8 character set. The first line in each file contains headers that describe what is in each column. A `\N` is used to denote that a particular field is missing or null for that title/name. The datasets of interest are as follows:

#### title.basics.tsv
- tconst (string) — alphanumeric unique identifier of the title
- titleType (string) — type/format of the title (movie, short, tvseries, tvepisode, ...)
- primaryTitle (string) — common/promotional title
- originalTitle (string) — original language title
- isAdult (boolean) — 0 non-adult; 1 adult
- startYear (YYYY) — release/start year (series start year for TV)
- endYear (YYYY) — TV series end year; `\N` otherwise
- runtimeMinutes (int) — primary runtime in minutes
- genres (string array) — up to three genres associated with the title

#### title.episode.tsv
- tconst (string) — alphanumeric identifier of episode
- parentTconst (string) — alphanumeric identifier of the parent TV Series
- seasonNumber (int) — season number the episode belongs to
- episodeNumber (int) — episode number in the TV series

#### title.ratings.tsv
- tconst (string) — alphanumeric unique identifier of the title
- averageRating (float) — weighted average of user ratings
- numVotes (int) — number of votes

## Quickstart

Run the full analysis (01–09) via Makefile after setting up the virtualenv:

```bash
python -m venv .venv
. .venv/bin/activate
pip install -r requirements.txt

# Full pipeline (uses defaults: TOP_GENRES_SURV=8, TOP_GENRES_COX=10, TEST_SIZE=0.2, T0=5.0, BOOTSTRAP=200, CURRENT_YEAR=2025)
make pipeline

# Or run individual steps
make wrangle
make visualize
make clean_data
make survival_eda
make group_tests
make cox
make parametric
make validate
make blog
```

You can override parameters when invoking targets, e.g.:

```bash
make validate BOOTSTRAP=500 T0=7.5
# set a different current year for wrangling/censoring
make pipeline CURRENT_YEAR=2024
```

## Repository structure

```text
.
├── 01_wrangle.py
├── 02_visualize.py
├── 03_clean.py
├── 04_survival_eda.py
├── 05_group_tests.py
├── 06_cox_model.py
├── 07_parametric_models.py
├── 08_validate.py
├── 09_blog_plots.py
├── Makefile
├── requirements.txt
├── README.md
├── plan.md
├── results/
│   ├── data_summary.csv
│   ├── km_tables.csv
│   ├── logrank_tests.csv
│   ├── cox_summary.csv
│   ├── parametric_comparison.csv
│   └── validation_metrics.json
└── visualizations/
    ├── distributions/
    ├── survival/
    ├── cox/
    ├── parametric/
    └── validation/
```

## Data wrangling (01_wrangle.py)

- __Sources__
  - `title.basics.tsv`: filter `titleType == tvSeries`; keep `tconst`, `primaryTitle` (as `title`), `startYear`, `endYear`, `genres`.
  - `title.ratings.tsv`: merge on `tconst`; keep `averageRating`, `numVotes`.
  - `title.episode.tsv`: group by `parentTconst` to compute per-show aggregates.

- **Variables**
  - `tconst`: unique show ID from basics.
  - `title`: `primaryTitle` from basics.
  - `startYear`: from basics; rows with missing are dropped.
  - `endYear`: from basics; may be null.
  - `event`: 1 if `endYear` present (show ended), else 0 (ongoing/censored).
  - `duration`: if `event==1` then `endYear - startYear`; else `currentYear - startYear` (default `2025`).
  - `genres`: raw comma-separated string (up to 3 values).
  - `genre_1`, `genre_2`, `genre_3`: split of `genres` by comma; fewer than three values leave remaining columns null.
  - `averageRating`, `numVotes`: from ratings; may be null.
  - `numEpisodes`: count of episodes per show (`title.episode.tsv` grouped by `parentTconst`).
  - `maxSeason`: max `seasonNumber` per show, ignoring missing.

- **Output** 
  - CSV: `data/tvseries_survival.csv` (UTF-8).

- **Re-run**
  - `./.venv/bin/python 01_wrangle.py --data-dir data --output data/tvseries_survival.csv --current-year 2025`

## Visualization (02_visualize.py)

- **Input**
  - CSV: `data/tvseries_survival.csv` (generated by `01_wrangle.py`).

- **Figures** (saved to `visualizations/distributions/`)
  - `01_lifespan_histogram.png`
  - `02_event_proportions.png`
  - `03_median_duration_by_start_decade.png`
  - `04_median_duration_top_genres.png`
  - `05_rating_vs_duration.png`
  - `06_numepisodes_histogram.png`
  - `07_correlation_heatmap.png`
  - `08_cumulative_endings_by_decade.png`

- **Re-run**
  - `./.venv/bin/python 02_visualize.py --input data/tvseries_survival.csv --outdir visualizations/distributions`

## Cleaning (03_clean.py)

- **Input**
  - CSV: `data/tvseries_survival.csv`

- **Outputs**
  - Cleaned CSV: `data/tvseries_survival_clean.csv`
  - Summary: `results/data_summary.csv`

- **Re-run**
  - `./.venv/bin/python 03_clean.py --input data/tvseries_survival.csv --output data/tvseries_survival_clean.csv --summary results/data_summary.csv`

## Survival EDA (04_survival_eda.py)

- **Input**
  - CSV: `data/tvseries_survival_clean.csv`

- **Figures** (saved to `visualizations/survival/`)
  - Kaplan–Meier survival curves: overall and by groups (genre, rating group, start decade)
  - Cumulative hazard and Nelson–Aalen cumulative hazard

- **Tables**
  - `results/km_tables.csv`

- **Re-run**
  - `./.venv/bin/python 04_survival_eda.py --input data/tvseries_survival_clean.csv --vizdir visualizations/survival --km-table results/km_tables.csv --top-genres 8`

## Group tests (05_group_tests.py)

- **Input**
  - CSV: `data/tvseries_survival_clean.csv`

- **Outputs**
  - Logrank test results: `results/logrank_tests.csv`
  - P-value heatmap: `visualizations/survival/logrank_pvalues_heatmap.png`

- **Re-run**
  - `./.venv/bin/python 05_group_tests.py --input data/tvseries_survival_clean.csv --out results/logrank_tests.csv --heatmap visualizations/survival/logrank_pvalues_heatmap.png --top-genres 8`

## Cox PH modeling (06_cox_model.py)

- **Input**
  - CSV: `data/tvseries_survival_clean.csv`

- **Figures** (saved to `visualizations/cox/`)
  - `cox_forest.png`
  - `schoenfeld_residuals.png`
  - `loglog_survival_rating_groups.png`

- **Tables**
  - `results/cox_summary.csv`

- **Re-run**
  - `./.venv/bin/python 06_cox_model.py --input data/tvseries_survival_clean.csv --results results/cox_summary.csv --vizdir visualizations/cox --top-genres 10`

## Parametric models (07_parametric_models.py)

- **Input**
  - CSV: `data/tvseries_survival_clean.csv`

- **Outputs**
  - Model comparison: `results/parametric_comparison.csv`
  - KM overlay: `visualizations/parametric/overlay_overall.png`

- **Re-run**
  - `./.venv/bin/python 07_parametric_models.py --input data/tvseries_survival_clean.csv --out results/parametric_comparison.csv --viz visualizations/parametric/overlay_overall.png`

## Validation (08_validate.py)

- **Input**
  - CSV: `data/tvseries_survival_clean.csv`

- **Metrics**
  - `results/validation_metrics.json`

- **Figures** (saved to `visualizations/validation/`)
  - Calibration at time horizon T0 (`calibration_t0.png`)
  - Bootstrap c-index histogram (if bootstraps > 0)

- **Re-run**
  - `./.venv/bin/python 08_validate.py --input data/tvseries_survival_clean.csv --metrics results/validation_metrics.json --vizdir visualizations/validation --test-size 0.2 --seed 42 --top-genres 10 --t0 5.0 --bootstrap 200`

## Blog plots (09_blog_plots.py)

- **Inputs**
  - CSV: `data/tvseries_survival_clean.csv`
  - Cox summary: `results/cox_summary.csv`

- **Figures** (saved to `visualizations/` subfolders)
  - `visualizations/cox/cox_forest_blog.png`
  - `visualizations/survival/hazard_shape_blog.png`
  - `visualizations/survival/km_by_genre_blog.png`
  - `visualizations/parametric/overlay_blog.png`

- **Re-run**
  - `./.venv/bin/python 09_blog_plots.py --input data/tvseries_survival_clean.csv --top-genres 8 --cox-summary results/cox_summary.csv`
